
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />


  <link rel="canonical" href="https://andrewwegner.com/zfs-pool-on-ubuntu.html">

  <meta name="robots" content="index, follow" />

  <link
    href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=block"
    rel="stylesheet">

  <link rel="stylesheet" type="text/css" href="https://andrewwegner.com/theme/stylesheet/style.min.css">
  <link rel="stylesheet" type="text/css"
    href="https://andrewwegner.com/theme/font-awesome/css/font-awesome-v4.css">


  <link id="pygments-light-theme" rel="stylesheet" type="text/css"     href="https://andrewwegner.com/theme/pygments/github.min.css">



  <link rel="stylesheet" type="text/css" href="https://andrewwegner.com/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="https://andrewwegner.com/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="https://andrewwegner.com/theme/font-awesome/css/solid.css">


<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="apple-touch-icon" sizes="180x180" href=" /apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">

  <!-- Chrome, Firefox OS and Opera -->
  <meta name="theme-color" content="#080019">
  <!-- Windows Phone -->
  <meta name="msapplication-navbutton-color" content="#080019">
  <!-- iOS Safari -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <!-- Microsoft EDGE -->
  <meta name="msapplication-TileColor" content="#080019">

  <link href="https://andrewwegner.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Ponderings of an Andy Atom">


<script type="text/javascript">
    window.heap = window.heap || [], heap.load = function (e, t) { window.heap.appid = e, window.heap.config = t = t || {}; var r = t.forceSSL || "https:" === document.location.protocol, a = document.createElement("script"); a.type = "text/javascript", a.async = !0, a.src = (r ? "https:" : "http:") + "//cdn.heapanalytics.com/js/heap-" + e + ".js"; var n = document.getElementsByTagName("script")[0]; n.parentNode.insertBefore(a, n); for (var o = function (e) { return function () { heap.push([e].concat(Array.prototype.slice.call(arguments, 0))) } }, p = ["addEventProperties", "addUserProperties", "clearEventProperties", "identify", "resetIdentity", "removeEventProperty", "setEventProperties", "track", "unsetEventProperty"], c = 0; c < p.length; c++)heap[p[c]] = o(p[c]) };
    heap.load("653100411");
</script>

<meta name="author" content="Andy Wegner" />
<meta name="description" content="With the backup server assembled, it&#39;s time to start configuring it. This post covers setting up the ZFS pool for all the data" />
<meta name="keywords" content="technical">


  <meta property="og:site_name" content="Ponderings of an Andy"/>
  <meta property="og:title" content="Setting up a ZFS pool on Ubuntu 16.04"/>
  <meta property="og:description" content="With the backup server assembled, it&#39;s time to start configuring it. This post covers setting up the ZFS pool for all the data"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="https://andrewwegner.com/zfs-pool-on-ubuntu.html"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2018-02-15 22:30:00-06:00"/>
  <meta property="article:modified_time" content=""/>
  <meta property="article:author" content="https://andrewwegner.com/author/andy-wegner.html">
  <meta property="article:section" content="Technical Solutions"/>
  <meta property="article:tag" content="technical"/>
  <meta property="og:image" content="/images/wegner_headshot.png">

  <title>Setting up a ZFS pool on Ubuntu 16.04  · Ponderings of an Andy
</title>

</head>

<body class="light-theme" >

<aside class="aside-border">
  <div>
    <a href="https://andrewwegner.com/">
      <img class="hex-logo" src="/images/wegner_headshot.png" alt="Ponderings of an Andy" title="Ponderings of an Andy">
    </a>


    <nav>
      <ul class="list">



        <li>
          <a target="_self" href="/">Home</a>
        </li>
        <li>
          <a target="_self" href="/about/">About Me</a>
        </li>
        <li>
          <a target="_self" href="/archives.html">Archives</a>
        </li>
        <li>
          <a target="_self" href="/categories.html">Categories</a>
        </li>
        <li>
          <a target="_self" href="/tags.html">Tags</a>
        </li>
      </ul>
    </nav>

    <h2>Article Contents</h2>
    <hr />
    <nav class="toc">
      <div class="toc">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#installing-zfs">Installing ZFS</a></li>
<li><a href="#setting-up-our-pool">Setting up our pool</a><ul>
<li><a href="#adding-the-gpt-label">Adding the GPT label</a></li>
<li><a href="#getting-device-ids">Getting device IDs</a></li>
<li><a href="#create-the-pool">Create the pool</a></li>
</ul>
</li>
<li><a href="#create-datasets">Create datasets</a></li>
<li><a href="#set-up-complete">Set up complete</a></li>
</ul>
</div>
    </nav>

    <ul class="social">
      <div class="itsmefooter">Andy Wegner</div>
      <li>
        <a id="andy-linkedin" class="sc-linkedin" rel="me"  href="https://www.linkedin.com/in/andrew-wegner/"
          target="_blank">
          <i class="fa-brands fa-linkedin"></i>
        </a>
      </li>
      <li>
        <a id="andy-stackoverflow" class="sc-stack-overflow" rel="me"  href="https://stackoverflow.com/users/189134/andy"
          target="_blank">
          <i class="fa-brands fa-stack-overflow"></i>
        </a>
      </li>
      <li>
        <a id="andy-github" class="sc-github" rel="me"  href="https://github.com/AWegnerGitHub/"
          target="_blank">
          <i class="fa-brands fa-github"></i>
        </a>
      </li>
      <li>
        <a id="andy-resume" class="sc-file-pdf"  href="/resume.pdf"
          target="_blank">
          <i class="fa-solid fa-file-pdf"></i>
        </a>
      </li>
      <li>
        <a id="andy-blogemail" class="sc-envelope" rel="me"  href="mailto:blog.feedback@andrewwegner.com"
          target="_blank">
          <i class="fa-solid fa-envelope"></i>
        </a>
      </li>
    </ul>
  </div>

</aside>
  <main>

<article class="single">
  <header>
    
<nav>
    <ul class="article-breadcrumbs">
        <li><a href="/"><i class="fa-sharp fa-solid fa-house"></i>&nbsp;Home</a></li>
        <li><i class="fa-solid fa-greater-than"></i>&nbsp;<a href="https://andrewwegner.com/categories.html">Categories</a></li>
        <li><i class="fa-solid fa-greater-than"></i>&nbsp;<a href="https://andrewwegner.com/category/technical-solutions.html">Technical Solutions</a>
        </li>
        <li><i class="fa-solid fa-greater-than"></i>&nbsp;<a href="https://andrewwegner.com/zfs-pool-on-ubuntu.html"><i
                    class="fa-solid fa-book"></i>&nbsp;<span class="breadcrumb-article">Setting up a ZFS pool on Ubuntu 16.04</span></li></a></li>
    </ul>
</nav>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
  {
    "@type": "ListItem",
    "position": 1,
    "item": 
    {
      "@id": "/",
      "name": "Ponderings of an Andy"
    }
  },
  {
    "@type": "ListItem",
    "position": 2,
    "item": 
    {
      "@id": "https://andrewwegner.com/categories.html",
      "name": "Categories"
    }
  }
  ,{
    "@type": "ListItem",
    "position": 3,
    "item": 
    {
      "@id": "https://andrewwegner.com/category/technical-solutions.html",
      "name": "Technical Solutions"
    }
  }
  ,{
    "@type": "ListItem",
    "position": 4,
    "item": 
    {
      "@id": "https://andrewwegner.com/zfs-pool-on-ubuntu.html",
      "name": "https://andrewwegner.com/zfs-pool-on-ubuntu.html"
    }
  }
  ]
}
</script>    <h1 id="zfs-pool-on-ubuntu">Setting up a ZFS pool on Ubuntu 16.04</h1>
    <p>
      Posted on Thu 15 February 2018 in <a href="https://andrewwegner.com/category/technical-solutions.html">Technical Solutions</a>


    <div class="tag-cloud">
      <p>
        <a href="https://andrewwegner.com/tag/technical.html">technical</a>
      </p>
    </div>
    </p>
  </header>

  <div>
    
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">¶</a></h2>
<p><a href="https://andrewwegner.com/new-house-server.html">Previously</a> in this series, the new NAS was assembled. Ubuntu 16.04 has been installed and updated. It's time to do something with all those hard drives!</p>
<p>I'll be setting the seven 4TB drives in a single <a href="https://en.wikipedia.org/wiki/ZFS">ZFS</a> pool. I'm using ZFS for protection against data corruption. It offers several other <a href="https://wiki.ubuntu.com/ZFS">features</a> too. I'll
be using dual parity, which means I could lose two drives and be able to recover. The goal is never to test this, but I'd rather not go through a <a href="https://andrewwegner.com/backup-your-data.html">data loss scare</a> again.</p>
<p>Before we begin, it's a good idea to ensure Ubuntu has been updated.</p>
<div class="codehilight code"><pre><span></span><code>sudo apt-get update &amp;&amp; sudo apt-get upgrade
</code></pre></div>
<p>With the update complete, let's get started.</p>
<h2 id="installing-zfs">Installing ZFS<a class="headerlink" href="#installing-zfs" title="Permanent link">¶</a></h2>
<p>Installing the ZFS file system is simple on Ubuntu.</p>
<div class="codehilight code"><pre><span></span><code>sudo apt-get install zfs parted
</code></pre></div>
<p>Ta-da! Your system is now capable of setting up ZFS pools. The <code>parted</code> package will be used to set up a ZFS pool shortly.</p>
<h2 id="setting-up-our-pool">Setting up our pool<a class="headerlink" href="#setting-up-our-pool" title="Permanent link">¶</a></h2>
<p>Pools are the basic building block of ZFS. A pool is made up of the underlying devices that will store the data. Setting up our ZFS pool requires a little bit of prep work
for our new drives. First, ensure that the <code>zfs</code> package installed correctly by running:</p>
<div class="codehilight code"><pre><span></span><code>sudo zpool status
</code></pre></div>
<p>At this point in the process, you should get the message <code>no pools available</code>. </p>
<h3 id="adding-the-gpt-label">Adding the GPT label<a class="headerlink" href="#adding-the-gpt-label" title="Permanent link">¶</a></h3>
<p>I'm setting up this pool with brand new drives. We need to add a <code>GPT</code> label to each disk so that ZFS doesn't complain about disks having an <code>invalid vdev specification</code> 
when we create the pool. To do this, we'll find the names of our drives first</p>
<div class="codehilight code"><pre><span></span><code>ls -l /dev/sd*
</code></pre></div>
<p>On my system, I get a result similar to this:</p>
<div class="codehilight code"><pre><span></span><code>brw-rw---- 1 root disk 8,   0 Feb 13 09:23 /dev/sda
brw-rw---- 1 root disk 8,   1 Feb 13 09:23 /dev/sda1
brw-rw---- 1 root disk 8,   2 Feb 13 09:23 /dev/sda2
brw-rw---- 1 root disk 8,   5 Feb 13 09:23 /dev/sda5
brw-rw---- 1 root disk 8,  16 Feb 13 09:23 /dev/sdb
brw-rw---- 1 root disk 8,  32 Feb 13 09:23 /dev/sdc
brw-rw---- 1 root disk 8,  48 Feb 13 09:23 /dev/sdd
brw-rw---- 1 root disk 8,  64 Feb 13 09:23 /dev/sde
brw-rw---- 1 root disk 8,  80 Feb 13 09:23 /dev/sdf
brw-rw---- 1 root disk 8,  96 Feb 13 09:23 /dev/sdg
brw-rw---- 1 root disk 8, 112 Feb 13 09:23 /dev/sdh
</code></pre></div>
<p>We'll be adding the <code>GPT</code> labels to each of the unformatted drives. The unformatted ones are the listed drives that don't have a numeral as well. For me, that means we'll
be working with <code>sdb</code>, <code>sdc</code>, <code>sdd</code>, <code>sde</code>, <code>sdf</code>, <code>sdg</code> and <code>sdh</code>. The <code>sda</code> drive has been formatted and contains partitions already. Those are <code>sda1</code>, <code>sda2</code> and <code>sda5</code>. </p>
<p>For each drive, except <code>sda</code> in my case, we need to run the <code>parted</code> command.</p>
<div class="codehilight code"><pre><span></span><code>sudo parted /dev/sdb
</code></pre></div>
<p>This will give you a short dialog. All you will need to do is issue the <code>mklabel GPT</code> command and then quit (using <code>q</code>)</p>
<div class="codehilight code"><pre><span></span><code>GNU Parted 3.2
Using /dev/sdb
Welcome to GNU Parted! Type 'help' to view a list of commands.
(parted) mklabel GPT
(parted) q
Information: You may need to update /etc/fstab.
</code></pre></div>
<h3 id="getting-device-ids">Getting device IDs<a class="headerlink" href="#getting-device-ids" title="Permanent link">¶</a></h3>
<p>Once the <code>GPT</code> labels are added, we can create our pool. However, we're not going to use the device paths returned above. Theoretically, those can change (especially if you 
replace a drive). That would be bad and mess with the entire ZFS pool. Instead we're going to create the pool by using the device id. </p>
<div class="codehilight code"><pre><span></span><code>ls -l /dev/disk/by-id/*
</code></pre></div>
<p>This returns output similar to this:</p>
<div class="codehilight code"><pre><span></span><code><span class="p">...</span>
<span class="n">lrwxrwxrwx</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">  </span><span class="mi">9</span><span class="w"> </span><span class="n">Feb</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="mi">09</span><span class="o">:</span><span class="mi">23</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">disk</span><span class="o">/</span><span class="n">by</span><span class="o">-</span><span class="n">id</span><span class="o">/</span><span class="n">wwn</span><span class="o">-</span><span class="mh">0x50014ee20f1d3114</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">..</span><span class="o">/</span><span class="p">..</span><span class="o">/</span><span class="n">sdc</span>
<span class="n">lrwxrwxrwx</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">  </span><span class="mi">9</span><span class="w"> </span><span class="n">Feb</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="mi">09</span><span class="o">:</span><span class="mi">23</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">disk</span><span class="o">/</span><span class="n">by</span><span class="o">-</span><span class="n">id</span><span class="o">/</span><span class="n">wwn</span><span class="o">-</span><span class="mh">0x50014ee20f3ba2b9</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">..</span><span class="o">/</span><span class="p">..</span><span class="o">/</span><span class="n">sdg</span>
<span class="n">lrwxrwxrwx</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">  </span><span class="mi">9</span><span class="w"> </span><span class="n">Feb</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="mi">09</span><span class="o">:</span><span class="mi">23</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">disk</span><span class="o">/</span><span class="n">by</span><span class="o">-</span><span class="n">id</span><span class="o">/</span><span class="n">wwn</span><span class="o">-</span><span class="mh">0x50014ee2647227b7</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">..</span><span class="o">/</span><span class="p">..</span><span class="o">/</span><span class="n">sdb</span>
<span class="n">lrwxrwxrwx</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">  </span><span class="mi">9</span><span class="w"> </span><span class="n">Feb</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="mi">09</span><span class="o">:</span><span class="mi">23</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">disk</span><span class="o">/</span><span class="n">by</span><span class="o">-</span><span class="n">id</span><span class="o">/</span><span class="n">wwn</span><span class="o">-</span><span class="mh">0x50014ee26490a21e</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">..</span><span class="o">/</span><span class="p">..</span><span class="o">/</span><span class="n">sdd</span>
<span class="n">lrwxrwxrwx</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">  </span><span class="mi">9</span><span class="w"> </span><span class="n">Feb</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="mi">09</span><span class="o">:</span><span class="mi">23</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">disk</span><span class="o">/</span><span class="n">by</span><span class="o">-</span><span class="n">id</span><span class="o">/</span><span class="n">wwn</span><span class="o">-</span><span class="mh">0x50014ee2b9c81501</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">..</span><span class="o">/</span><span class="p">..</span><span class="o">/</span><span class="n">sdh</span>
<span class="n">lrwxrwxrwx</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">  </span><span class="mi">9</span><span class="w"> </span><span class="n">Feb</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="mi">09</span><span class="o">:</span><span class="mi">23</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">disk</span><span class="o">/</span><span class="n">by</span><span class="o">-</span><span class="n">id</span><span class="o">/</span><span class="n">wwn</span><span class="o">-</span><span class="mh">0x50014ee2b9e6ab61</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">..</span><span class="o">/</span><span class="p">..</span><span class="o">/</span><span class="n">sdf</span>
<span class="n">lrwxrwxrwx</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">  </span><span class="mi">9</span><span class="w"> </span><span class="n">Feb</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="mi">09</span><span class="o">:</span><span class="mi">23</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">disk</span><span class="o">/</span><span class="n">by</span><span class="o">-</span><span class="n">id</span><span class="o">/</span><span class="n">wwn</span><span class="o">-</span><span class="mh">0x50014ee2b9e6b857</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">..</span><span class="o">/</span><span class="p">..</span><span class="o">/</span><span class="n">sde</span>
<span class="n">lrwxrwxrwx</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">  </span><span class="mi">9</span><span class="w"> </span><span class="n">Feb</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="mi">09</span><span class="o">:</span><span class="mi">23</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">disk</span><span class="o">/</span><span class="n">by</span><span class="o">-</span><span class="n">id</span><span class="o">/</span><span class="n">wwn</span><span class="o">-</span><span class="mh">0x5001b444a9525c87</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">..</span><span class="o">/</span><span class="p">..</span><span class="o">/</span><span class="n">sda</span>
<span class="n">lrwxrwxrwx</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="n">Feb</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="mi">09</span><span class="o">:</span><span class="mi">23</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">disk</span><span class="o">/</span><span class="n">by</span><span class="o">-</span><span class="n">id</span><span class="o">/</span><span class="n">wwn</span><span class="o">-</span><span class="mh">0x5001b444a9525c87</span><span class="o">-</span><span class="n">part1</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">..</span><span class="o">/</span><span class="p">..</span><span class="o">/</span><span class="n">sda1</span>
<span class="n">lrwxrwxrwx</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="n">Feb</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="mi">09</span><span class="o">:</span><span class="mi">23</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">disk</span><span class="o">/</span><span class="n">by</span><span class="o">-</span><span class="n">id</span><span class="o">/</span><span class="n">wwn</span><span class="o">-</span><span class="mh">0x5001b444a9525c87</span><span class="o">-</span><span class="n">part2</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">..</span><span class="o">/</span><span class="p">..</span><span class="o">/</span><span class="n">sda2</span>
<span class="n">lrwxrwxrwx</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="n">Feb</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="mi">09</span><span class="o">:</span><span class="mi">23</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">disk</span><span class="o">/</span><span class="n">by</span><span class="o">-</span><span class="n">id</span><span class="o">/</span><span class="n">wwn</span><span class="o">-</span><span class="mh">0x5001b444a9525c87</span><span class="o">-</span><span class="n">part5</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">..</span><span class="o">/</span><span class="p">..</span><span class="o">/</span><span class="n">sda5</span>

<span class="p">...</span>
<span class="n">lrwxrwxrwx</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">  </span><span class="mi">9</span><span class="w"> </span><span class="n">Feb</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="mi">09</span><span class="o">:</span><span class="mi">23</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">disk</span><span class="o">/</span><span class="n">by</span><span class="o">-</span><span class="n">id</span><span class="o">/</span><span class="n">ata</span><span class="o">-</span><span class="n">WDC_WD40EFRX</span><span class="o">-</span><span class="mi">68</span><span class="n">N32N0_WD</span><span class="o">-</span><span class="n">WCC7K0HLKUXT</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">..</span><span class="o">/</span><span class="p">..</span><span class="o">/</span><span class="n">sdb</span>
<span class="n">lrwxrwxrwx</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">  </span><span class="mi">9</span><span class="w"> </span><span class="n">Feb</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="mi">09</span><span class="o">:</span><span class="mi">23</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">disk</span><span class="o">/</span><span class="n">by</span><span class="o">-</span><span class="n">id</span><span class="o">/</span><span class="n">ata</span><span class="o">-</span><span class="n">WDC_WD40EFRX</span><span class="o">-</span><span class="mi">68</span><span class="n">N32N0_WD</span><span class="o">-</span><span class="n">WCC7K0HLKXS0</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">..</span><span class="o">/</span><span class="p">..</span><span class="o">/</span><span class="n">sdc</span>
<span class="n">lrwxrwxrwx</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">  </span><span class="mi">9</span><span class="w"> </span><span class="n">Feb</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="mi">09</span><span class="o">:</span><span class="mi">23</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">disk</span><span class="o">/</span><span class="n">by</span><span class="o">-</span><span class="n">id</span><span class="o">/</span><span class="n">ata</span><span class="o">-</span><span class="n">WDC_WD40EFRX</span><span class="o">-</span><span class="mi">68</span><span class="n">N32N0_WD</span><span class="o">-</span><span class="n">WCC7K4YJ6T0U</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">..</span><span class="o">/</span><span class="p">..</span><span class="o">/</span><span class="n">sdg</span>
<span class="n">lrwxrwxrwx</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">  </span><span class="mi">9</span><span class="w"> </span><span class="n">Feb</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="mi">09</span><span class="o">:</span><span class="mi">23</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">disk</span><span class="o">/</span><span class="n">by</span><span class="o">-</span><span class="n">id</span><span class="o">/</span><span class="n">ata</span><span class="o">-</span><span class="n">WDC_WD40EFRX</span><span class="o">-</span><span class="mi">68</span><span class="n">N32N0_WD</span><span class="o">-</span><span class="n">WCC7K5LCEYN4</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">..</span><span class="o">/</span><span class="p">..</span><span class="o">/</span><span class="n">sdf</span>
<span class="n">lrwxrwxrwx</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">  </span><span class="mi">9</span><span class="w"> </span><span class="n">Feb</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="mi">09</span><span class="o">:</span><span class="mi">23</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">disk</span><span class="o">/</span><span class="n">by</span><span class="o">-</span><span class="n">id</span><span class="o">/</span><span class="n">ata</span><span class="o">-</span><span class="n">WDC_WD40EFRX</span><span class="o">-</span><span class="mi">68</span><span class="n">N32N0_WD</span><span class="o">-</span><span class="n">WCC7K6VNN6TA</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">..</span><span class="o">/</span><span class="p">..</span><span class="o">/</span><span class="n">sde</span>
<span class="n">lrwxrwxrwx</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">  </span><span class="mi">9</span><span class="w"> </span><span class="n">Feb</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="mi">09</span><span class="o">:</span><span class="mi">23</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">disk</span><span class="o">/</span><span class="n">by</span><span class="o">-</span><span class="n">id</span><span class="o">/</span><span class="n">ata</span><span class="o">-</span><span class="n">WDC_WD40EFRX</span><span class="o">-</span><span class="mi">68</span><span class="n">N32N0_WD</span><span class="o">-</span><span class="n">WCC7K6VNNTXY</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">..</span><span class="o">/</span><span class="p">..</span><span class="o">/</span><span class="n">sdd</span>
<span class="n">lrwxrwxrwx</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">  </span><span class="mi">9</span><span class="w"> </span><span class="n">Feb</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="mi">09</span><span class="o">:</span><span class="mi">23</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">disk</span><span class="o">/</span><span class="n">by</span><span class="o">-</span><span class="n">id</span><span class="o">/</span><span class="n">ata</span><span class="o">-</span><span class="n">WDC_WD40EFRX</span><span class="o">-</span><span class="mi">68</span><span class="n">N32N0_WD</span><span class="o">-</span><span class="n">WCC7K7TSA4VS</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">..</span><span class="o">/</span><span class="p">..</span><span class="o">/</span><span class="n">sdh</span>
<span class="n">lrwxrwxrwx</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">  </span><span class="mi">9</span><span class="w"> </span><span class="n">Feb</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="mi">09</span><span class="o">:</span><span class="mi">23</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">disk</span><span class="o">/</span><span class="n">by</span><span class="o">-</span><span class="n">id</span><span class="o">/</span><span class="n">ata</span><span class="o">-</span><span class="n">WDC_WDS100T1B0A</span><span class="o">-</span><span class="mo">00</span><span class="n">H9H0_174256421671</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">..</span><span class="o">/</span><span class="p">..</span><span class="o">/</span><span class="n">sda</span>
<span class="n">lrwxrwxrwx</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="n">Feb</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="mi">09</span><span class="o">:</span><span class="mi">23</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">disk</span><span class="o">/</span><span class="n">by</span><span class="o">-</span><span class="n">id</span><span class="o">/</span><span class="n">ata</span><span class="o">-</span><span class="n">WDC_WDS100T1B0A</span><span class="o">-</span><span class="mo">00</span><span class="n">H9H0_174256421671</span><span class="o">-</span><span class="n">part1</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">..</span><span class="o">/</span><span class="p">..</span><span class="o">/</span><span class="n">sda1</span>
<span class="n">lrwxrwxrwx</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="n">Feb</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="mi">09</span><span class="o">:</span><span class="mi">23</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">disk</span><span class="o">/</span><span class="n">by</span><span class="o">-</span><span class="n">id</span><span class="o">/</span><span class="n">ata</span><span class="o">-</span><span class="n">WDC_WDS100T1B0A</span><span class="o">-</span><span class="mo">00</span><span class="n">H9H0_174256421671</span><span class="o">-</span><span class="n">part2</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">..</span><span class="o">/</span><span class="p">..</span><span class="o">/</span><span class="n">sda2</span>
<span class="n">lrwxrwxrwx</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="n">Feb</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="mi">09</span><span class="o">:</span><span class="mi">23</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">disk</span><span class="o">/</span><span class="n">by</span><span class="o">-</span><span class="n">id</span><span class="o">/</span><span class="n">ata</span><span class="o">-</span><span class="n">WDC_WDS100T1B0A</span><span class="o">-</span><span class="mo">00</span><span class="n">H9H0_174256421671</span><span class="o">-</span><span class="n">part5</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">..</span><span class="o">/</span><span class="p">..</span><span class="o">/</span><span class="n">sda5</span>
</code></pre></div>
<p>Notice that both formats symlink to the same location. This means you can pick which ever format you like better. However, I recommend the second one that contains the 
device serial number. It'll make it easier to determine problem disks in the future. </p>
<h3 id="create-the-pool">Create the pool<a class="headerlink" href="#create-the-pool" title="Permanent link">¶</a></h3>
<p>Now that we've determined the device ides for each of our hard drives, it's time to actually create the pool. As I mentioned above, we'll be creating using dual parity
(<code>raidz2</code>). We'll be naming our pool <code>data</code>. Once this command is complete, <code>/data</code> will be where this pool resides.</p>
<div class="codehilight code"><pre><span></span><code>sudo zpool create data raidz2 /dev/disk/by-id/ata-WDC_WD40EFRX-68N32N0_WD-WCC7K0HLKUXT /dev/disk/by-id/ata-WDC_WD40EFRX-68N32N0_WD-WCC7K0HLKXS0 /dev/disk/by-id/ata-WDC_WD40EFRX-68N32N0_WD-WCC7K6VNNTXY /dev/disk/by-id/ata-WDC_WD40EFRX-68N32N0_WD-WCC7K6VNN6TA /dev/disk/by-id/ata-WDC_WD40EFRX-68N32N0_WD-WCC7K5LCEYN4 /dev/disk/by-id/ata-WDC_WD40EFRX-68N32N0_WD-WCC7K4YJ6T0U /dev/disk/by-id/ata-WDC_WD40EFRX-68N32N0_WD-WCC7K7TSA4VS
</code></pre></div>
<p>This will take a little while, but a surprisingly smaller amount of time than I initially expected. </p>
<p>Once the creation is complete, take a look at the status of your new pool:</p>
<div class="codehilight code"><pre><span></span><code>sudo zpool status

  pool: data
 state: ONLINE
  scan: none requested
config:

        NAME                                          STATE     READ WRITE CKSUM
        data                                          ONLINE       0     0     0
          raidz2-0                                    ONLINE       0     0     0
            ata-WDC_WD40EFRX-68N32N0_WD-WCC7K0HLKUXT  ONLINE       0     0     0
            ata-WDC_WD40EFRX-68N32N0_WD-WCC7K0HLKXS0  ONLINE       0     0     0
            ata-WDC_WD40EFRX-68N32N0_WD-WCC7K6VNNTXY  ONLINE       0     0     0
            ata-WDC_WD40EFRX-68N32N0_WD-WCC7K6VNN6TA  ONLINE       0     0     0
            ata-WDC_WD40EFRX-68N32N0_WD-WCC7K5LCEYN4  ONLINE       0     0     0
            ata-WDC_WD40EFRX-68N32N0_WD-WCC7K4YJ6T0U  ONLINE       0     0     0
            ata-WDC_WD40EFRX-68N32N0_WD-WCC7K7TSA4VS  ONLINE       0     0     0

errors: No known data errors
</code></pre></div>
<p>That last line is important. No known data errors is good. </p>
<h2 id="create-datasets">Create datasets<a class="headerlink" href="#create-datasets" title="Permanent link">¶</a></h2>
<p>Where pools are the basic building blocks of ZFS, datasets is a term for a ZFS file system, volume, snapshot or clone. Each dataset can be managed and configured differently.
This means that you can compress one dataset, but leave the others alone. You can put a quota on one, but leave the others without a quota. Creating a dataset is pretty easy:</p>
<div class="codehilight code"><pre><span></span><code>cd /
sudo zfs create data/storage
</code></pre></div>
<p>This will create a dataset that exists at <code>/data</code> named <code>storage</code>. You can have child datasets that inherit attributes from parents (or even grandparents) by doing something
like:</p>
<div class="codehilight code"><pre><span></span><code>sudo zfs create data/storage/music
</code></pre></div>
<p>This will create the new dataset at <code>/data/storage</code> named <code>music</code>.</p>
<p>Once you've set up your datasets, you can see they were all created and how much space they have available by issuing <code>sudo zfs list</code>.</p>
<h2 id="set-up-complete">Set up complete<a class="headerlink" href="#set-up-complete" title="Permanent link">¶</a></h2>
<p>With that, we've finished setting up ZFS on Ubuntu 16.04. I set up a few datasets for my purposes. I'm one step closer to getting this running and handling all of the 
digital data in the house. </p>
  </div>
<div class="neighbors">
  <a class="btn float-left" href="https://andrewwegner.com/new-house-server.html"
    title="...and then there was a backup server">
    <i class="fa fa-angle-left"></i> Previous Post
  </a>
  <a class="btn float-right" href="https://andrewwegner.com/installing-nextcloud.html"
    title="Installing NextCloud">
    Next Post <i class="fa fa-angle-right"></i>
  </a>
</div>



  <hr />
  <div>
            <span class="author_blurb"><a href="https://andrewwegner.com/" rel="author"><span class="author_name">Andy Wegner</span></a> -
             is a father, an engineer and a computer scientist. He is interested in online
            community building, tinkering with new code and building new applications.
            He writes about his experiences with each of these.</span>

  </div>


  <div class="related-posts">
    <h4>Part 3 of the Recovering from data loss series</h4>
    <h5>Previous articles</h5>
    <ul>
      <li><a href="https://andrewwegner.com/backup-your-data.html">Well, there goes my data...</a></li>
      <li><a href="https://andrewwegner.com/new-house-server.html">...and then there was a backup server</a></li>
    </ul>
    <h5>Next articles</h5>
    <ul>
      <li><a href="https://andrewwegner.com/installing-nextcloud.html">Installing NextCloud</a></li>
      <li><a href="https://andrewwegner.com/installing-gitlab.html">Setting up GitLab on the new server</a></li>
      <li><a href="https://andrewwegner.com/setup-lets-encrypt.html">Set up Dynamic CloudFlare IP with Let's Encrypt</a></li>
    </ul>
  </div>
</article>

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "name": "Setting up a ZFS pool on Ubuntu 16.04",
  "headline": "Setting up a ZFS pool on Ubuntu 16.04",
  "dateCreated": "2018-02-15 22:30:00-06:00",
  "datePublished": "2018-02-15 22:30:00-06:00",
  "dateModified": "",
  "copyrightYear": "2018",
  "copyrightHolder": {
    "@type": "Person",
    "name": "Andy Wegner",
    "url": "https://andrewwegner.com"
  },
  "author": {
    "@type": "Person",
    "name": "Andy Wegner",
    "sameAs": [
      "https://www.andrewwegner.com/about/"
      ],
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https://www.andrewwegner.com/about/"
      }
  },
  "publisher": {
    "@type": "Person",
    "name": "Andy Wegner",
    "sameAs": [
      "https://www.andrewwegner.com/about/"
      ]
  },
  "image": "/images/wegner_headshot.png",
  "url": "https://andrewwegner.com/zfs-pool-on-ubuntu.html",
  "description": "With the backup server assembled, it's time to start configuring it. This post covers setting up the ZFS pool for all the data",
  "mainEntityOfPage": "True",
  "articleSection": "Technical Solutions"
}
</script>
<footer>
<p>&copy; 2023 Andrew Wegner</p>
</footer>  </main>

<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Ponderings of an Andy ",
  "url" : "https://andrewwegner.com",
  "image": "/images/wegner_headshot.png",
  "description": "Articles and reviews covering thoughts on work place leadership, technical course reviews, and other ponderings of Andy"
}
</script>
</body>

</html>